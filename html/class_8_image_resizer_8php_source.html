<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>KS-CMS: Исходный файл modules/main/libs/class.ImageResizer.php</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Создано системой Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Титульная&nbsp;страница</span></a></li>
      <li><a href="pages.html"><span>Описания</span></a></li>
      <li><a href="namespaces.html"><span>Пространства&nbsp;имен</span></a></li>
      <li><a href="annotated.html"><span>Структуры&nbsp;данных</span></a></li>
      <li class="current"><a href="files.html"><span>Файлы</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>Файлы</span></a></li>
      <li><a href="globals.html"><span>Список&nbsp;членов&nbsp;всех&nbsp;файлов</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>modules/main/libs/class.ImageResizer.php</h1>  </div>
</div>
<div class="contents">
<a href="class_8_image_resizer_8php.html">См. документацию.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00069"></a><a class="code" href="class_image_resizer.html">00069</a> <span class="keyword">class </span><a class="code" href="class_image_resizer.html">ImageResizer</a> <span class="keyword">extends</span> <a class="code" href="class_c_base_object.html">CBaseObject</a>
<a name="l00070"></a>00070 {
<a name="l00071"></a><a class="code" href="class_image_resizer.html#acbe7e7e36198446aa76bc0a762d7f512">00071</a>         var <a class="code" href="class_image_resizer.html#acbe7e7e36198446aa76bc0a762d7f512">$inputfile</a>;
<a name="l00072"></a><a class="code" href="class_image_resizer.html#a6257f8f380de75814e5c2f33e3520c83">00072</a>         var <a class="code" href="class_image_resizer.html#a6257f8f380de75814e5c2f33e3520c83">$myfile</a>;
<a name="l00073"></a><a class="code" href="class_image_resizer.html#a08ca978795d13de8f801d343ea6fcaac">00073</a>         var <a class="code" href="class_image_resizer.html#a08ca978795d13de8f801d343ea6fcaac">$newfilename</a>;             <span class="comment">// Имя нового файла (полный путь с именем)</span>
<a name="l00074"></a><a class="code" href="class_image_resizer.html#ab9f403e1ce4997d4cc770f7337bce9d9">00074</a>         var <a class="code" href="class_image_resizer.html#ab9f403e1ce4997d4cc770f7337bce9d9">$newdirname</a>;              <span class="comment">// Имя папки для нового файла</span>
<a name="l00075"></a><a class="code" href="class_image_resizer.html#ab0a40b69609132792dbde030e2a11814">00075</a>         var <a class="code" href="class_image_resizer.html#ab0a40b69609132792dbde030e2a11814">$file_dirname</a>;            <span class="comment">// Абсолютный путь к исх. файлу</span>
<a name="l00076"></a><a class="code" href="class_image_resizer.html#a59bf132c77b5bee5adff2098cc2a6fbc">00076</a>         var <a class="code" href="class_image_resizer.html#a59bf132c77b5bee5adff2098cc2a6fbc">$file_name</a>;               <span class="comment">// Имя файла с расширением</span>
<a name="l00077"></a><a class="code" href="class_image_resizer.html#aa1f09bf069b96199dfa18d6553c7e45c">00077</a>         var <a class="code" href="class_image_resizer.html#aa1f09bf069b96199dfa18d6553c7e45c">$file_name_body</a>;          <span class="comment">// Имя файла без расширения</span>
<a name="l00078"></a><a class="code" href="class_image_resizer.html#a65b080519869bc14d792c1800e3362f5">00078</a>         var <a class="code" href="class_image_resizer.html#a65b080519869bc14d792c1800e3362f5">$file_ext</a>;                <span class="comment">// Расширение файла</span>
<a name="l00079"></a><a class="code" href="class_image_resizer.html#a477bb9e848bd207c976e02e4af311c1a">00079</a>         var <a class="code" href="class_image_resizer.html#a477bb9e848bd207c976e02e4af311c1a">$width_orig</a>;              <span class="comment">// Ширина</span>
<a name="l00080"></a><a class="code" href="class_image_resizer.html#a11529ebb5e93542b8e3ff5d005010ad5">00080</a>         var <a class="code" href="class_image_resizer.html#a11529ebb5e93542b8e3ff5d005010ad5">$height_orig</a>;             <span class="comment">// Высота</span>
<a name="l00081"></a><a class="code" href="class_image_resizer.html#af7e5a86ea53935f3667e1a89fabe365d">00081</a>         var <a class="code" href="class_image_resizer.html#af7e5a86ea53935f3667e1a89fabe365d">$allow_ext</a>;               <span class="comment">// Разрешенные расширения файлов</span>
<a name="l00082"></a><a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">00082</a>         var <a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">$image_w</a>;                 <span class="comment">// Размер width</span>
<a name="l00083"></a><a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">00083</a>         var <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a>;                 <span class="comment">// Размер height</span>
<a name="l00084"></a><a class="code" href="class_image_resizer.html#a908665ec9bdb92fc34595720c1828c97">00084</a>         var <a class="code" href="class_image_resizer.html#a908665ec9bdb92fc34595720c1828c97">$StandartWidth</a> = 500;     <span class="comment">// </span>
<a name="l00085"></a><a class="code" href="class_image_resizer.html#a86ebc0c3c4de6070398a2e6919710cc7">00085</a>         var <a class="code" href="class_image_resizer.html#a86ebc0c3c4de6070398a2e6919710cc7">$StandartHeight</a> = 500;    <span class="comment">//</span>
<a name="l00086"></a><a class="code" href="class_image_resizer.html#a651840f0c052785485c2d0c72294a8a8">00086</a>         var <a class="code" href="class_image_resizer.html#a651840f0c052785485c2d0c72294a8a8">$OrigWidth</a> = 3000;         <span class="comment">//</span>
<a name="l00087"></a><a class="code" href="class_image_resizer.html#aa081ddaa95fcb64f62e86421ab3c3bd6">00087</a>         var <a class="code" href="class_image_resizer.html#aa081ddaa95fcb64f62e86421ab3c3bd6">$OrigHeigth</a> = 3000;        <span class="comment">//</span>
<a name="l00088"></a><a class="code" href="class_image_resizer.html#a939d6733d998cce893403d2f59f40317">00088</a>         var <a class="code" href="class_image_resizer.html#a939d6733d998cce893403d2f59f40317">$image_type</a>;              <span class="comment">// Тип изображения</span>
<a name="l00089"></a><a class="code" href="class_image_resizer.html#a8aa9c007d7fe55244da93c464c33d3e1">00089</a>         var <a class="code" href="class_image_resizer.html#a8aa9c007d7fe55244da93c464c33d3e1">$image_ratio</a>;             <span class="comment">// Пропорциональный ресайз</span>
<a name="l00090"></a><a class="code" href="class_image_resizer.html#afd83adcc482bcd473ff612fe57a36607">00090</a>         var <a class="code" href="class_image_resizer.html#afd83adcc482bcd473ff612fe57a36607">$image_ratio_wb</a>;          <span class="comment">// Добавление белых полей при $image_ratio = false</span>
<a name="l00091"></a><a class="code" href="class_image_resizer.html#a862bada7b1fb85f9d14e485a87ccf1f4">00091</a>         var <a class="code" href="class_image_resizer.html#a862bada7b1fb85f9d14e485a87ccf1f4">$border_color</a>;             <span class="comment">// Цвет &quot;белых&quot; полей. </span>
<a name="l00092"></a><a class="code" href="class_image_resizer.html#a0e342ea32cccdc2c932ad23b9796a62a">00092</a>         var <a class="code" href="class_image_resizer.html#a0e342ea32cccdc2c932ad23b9796a62a">$quality</a>;                 <span class="comment">// Качество 0 - 100</span>
<a name="l00093"></a><a class="code" href="class_image_resizer.html#ad8396a9ad2927b2063941d930bab245b">00093</a>         var <a class="code" href="class_image_resizer.html#ad8396a9ad2927b2063941d930bab245b">$isSave</a> = <span class="keyword">true</span>;           <span class="comment">// Сохранять конечное изображение на диск</span>
<a name="l00094"></a><a class="code" href="class_image_resizer.html#aac48d26ac76167a0e930b82e7c598f3d">00094</a>         var <a class="code" href="class_image_resizer.html#aac48d26ac76167a0e930b82e7c598f3d">$isCreateDir</a> = <span class="keyword">true</span>;
<a name="l00095"></a><a class="code" href="class_image_resizer.html#adce7318dfd74ece5ddd4ff1164be33a3">00095</a>         var <a class="code" href="class_image_resizer.html#adce7318dfd74ece5ddd4ff1164be33a3">$SaveOriginal</a> = <span class="keyword">false</span>;    <span class="comment">// Сохранение оригинала изображения</span>
<a name="l00096"></a><a class="code" href="class_image_resizer.html#a70c216faa8cc54dda8a1336eb374e158">00096</a>         var <a class="code" href="class_image_resizer.html#a70c216faa8cc54dda8a1336eb374e158">$square_align</a> = <span class="stringliteral">&#39;center&#39;</span>;
<a name="l00097"></a><a class="code" href="class_image_resizer.html#a655f95395ae86110a12e12238ff31ceb">00097</a>         var <a class="code" href="class_image_resizer.html#a655f95395ae86110a12e12238ff31ceb">$oreintation</a> = 0;
<a name="l00101"></a><a class="code" href="class_image_resizer.html#af1225d1d3836bf925d2cd3fe87468d1d">00101</a>         <span class="keyword">protected</span> <a class="code" href="class_image_resizer.html#af1225d1d3836bf925d2cd3fe87468d1d">$newImage</a>;
<a name="l00105"></a><a class="code" href="class_image_resizer.html#ab91afcad9ff74fb80b7514f9d2704f53">00105</a>         <span class="keyword">static</span> <a class="code" href="class_image_resizer.html#ab91afcad9ff74fb80b7514f9d2704f53">$arAllowExt</a>=array(<span class="stringliteral">&#39;jpg&#39;</span>,<span class="stringliteral">&#39;jpeg&#39;</span>,<span class="stringliteral">&#39;png&#39;</span>);
<a name="l00106"></a>00106         
<a name="l00107"></a><a class="code" href="class_image_resizer.html#aebe67aa5a1ffd41a69811e38427c8eba">00107</a>         function <a class="code" href="class_image_resizer.html#aebe67aa5a1ffd41a69811e38427c8eba">__construct</a>(<a class="code" href="class_image_resizer.html#acbe7e7e36198446aa76bc0a762d7f512">$inputfile</a>,$bRoot=<span class="keyword">false</span>)
<a name="l00108"></a>00108         {
<a name="l00109"></a>00109                 $this-&gt;inputfile = <a class="code" href="class_image_resizer.html#acbe7e7e36198446aa76bc0a762d7f512">$inputfile</a>;
<a name="l00110"></a>00110                 <span class="keywordflow">if</span>(!$bRoot) <a class="code" href="class_image_resizer.html#acbe7e7e36198446aa76bc0a762d7f512">$inputfile</a> = ROOT_DIR.$inputfile;
<a name="l00111"></a>00111                 <span class="keywordflow">if</span>(!is_file(<a class="code" href="class_image_resizer.html#acbe7e7e36198446aa76bc0a762d7f512">$inputfile</a>)) { <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_c_error.html">CError</a>(<span class="stringliteral">&#39;No input file! [&#39;</span>.<a class="code" href="class_image_resizer.html#acbe7e7e36198446aa76bc0a762d7f512">$inputfile</a>.<span class="charliteral">&#39;]&#39;</span>);}
<a name="l00112"></a>00112                 
<a name="l00113"></a>00113                 $info = pathinfo(<a class="code" href="class_image_resizer.html#acbe7e7e36198446aa76bc0a762d7f512">$inputfile</a>); <span class="comment">// Информация о файле</span>
<a name="l00114"></a>00114                 
<a name="l00115"></a>00115                 <span class="comment">/* Проверка расширения */</span>
<a name="l00116"></a>00116 
<a name="l00117"></a>00117                 <span class="keywordflow">if</span>(!$bRoot &amp;&amp; !in_array(strtolower($info[<span class="stringliteral">&#39;extension&#39;</span>]),self::$arAllowExt))
<a name="l00118"></a>00118                         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_c_error.html">CError</a>(<span class="stringliteral">&#39;PHOTOGALLERY_WRONG_FILE&#39;</span>,0,<a class="code" href="class_image_resizer.html#acbe7e7e36198446aa76bc0a762d7f512">$inputfile</a>);
<a name="l00119"></a>00119                 <span class="comment">/* //Проверка расширения */</span>
<a name="l00120"></a>00120                 
<a name="l00121"></a>00121                 list(<a class="code" href="kcaptcha__config_8php.html#a5795120b4b324bc4ca83f1e6fdce7d57">$width</a>, <a class="code" href="kcaptcha__config_8php.html#a2c265bba1724371bb03e6901297c30b2">$height</a>, <a class="code" href="main_2fields_2file_2config_8php.html#abe0b3d169d70eace6fd953dfc091f088">$type</a>, $attr) = getimagesize(<a class="code" href="class_image_resizer.html#acbe7e7e36198446aa76bc0a762d7f512">$inputfile</a>);
<a name="l00122"></a>00122                 
<a name="l00123"></a>00123                 $this-&gt;myfile = <a class="code" href="class_image_resizer.html#acbe7e7e36198446aa76bc0a762d7f512">$inputfile</a>;
<a name="l00124"></a>00124                 $this-&gt;file_dirname = $info[<span class="stringliteral">&#39;dirname&#39;</span>];
<a name="l00125"></a>00125                 $this-&gt;file_name = $info[<span class="stringliteral">&#39;basename&#39;</span>];
<a name="l00126"></a>00126                 $this-&gt;file_name_body = $info[<span class="stringliteral">&#39;filename&#39;</span>];
<a name="l00127"></a>00127                 $this-&gt;file_ext = $info[<span class="stringliteral">&#39;extension&#39;</span>];
<a name="l00128"></a>00128                 $this-&gt;width_orig = <a class="code" href="kcaptcha__config_8php.html#a5795120b4b324bc4ca83f1e6fdce7d57">$width</a>;
<a name="l00129"></a>00129                 $this-&gt;height_orig = <a class="code" href="kcaptcha__config_8php.html#a2c265bba1724371bb03e6901297c30b2">$height</a>;
<a name="l00130"></a>00130                 $this-&gt;image_type = <a class="code" href="main_2fields_2file_2config_8php.html#abe0b3d169d70eace6fd953dfc091f088">$type</a>;
<a name="l00131"></a>00131                 
<a name="l00132"></a>00132                 <span class="keywordflow">if</span>($this-&gt;width_orig*$this-&gt;height_orig*4&gt;(<a class="code" href="main_2libs_2functions_8php.html#a9103d1a2e8cdef9b3136b8a2a844a8ba">GetMaxMemory</a>()-1024*1024))
<a name="l00133"></a>00133                 {
<a name="l00134"></a>00134                         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_c_error.html">CError</a>(SYSTEM_NO_MEMORY,1,($this-&gt;width_orig*$this-&gt;height_orig*4).<span class="charliteral">&#39;/&#39;</span>.(<a class="code" href="main_2libs_2functions_8php.html#a9103d1a2e8cdef9b3136b8a2a844a8ba">GetMaxMemory</a>()-1024*1024));   
<a name="l00135"></a>00135                 }
<a name="l00136"></a>00136                 $this-&gt;quality = 93;
<a name="l00137"></a>00137         }
<a name="l00138"></a>00138         
<a name="l00142"></a><a class="code" href="class_image_resizer.html#a421831a265621325e1fdd19aace0c758">00142</a>         function <a class="code" href="class_image_resizer.html#a421831a265621325e1fdd19aace0c758">__destruct</a>()
<a name="l00143"></a>00143         {
<a name="l00144"></a>00144                 <span class="keywordflow">if</span>($this-&gt;newImage)
<a name="l00145"></a>00145                 {
<a name="l00146"></a>00146                         imagedestroy($this-&gt;newImage);
<a name="l00147"></a>00147                         $this-&gt;newImage=0;
<a name="l00148"></a>00148                 }
<a name="l00149"></a>00149         }
<a name="l00150"></a>00150         
<a name="l00151"></a><a class="code" href="class_image_resizer.html#a29c611ea77c8a508fd3323e880f37109">00151</a>         function <a class="code" href="class_image_resizer.html#a29c611ea77c8a508fd3323e880f37109">NewDirName</a>($w,$h)
<a name="l00152"></a>00152         {
<a name="l00153"></a>00153                 <span class="keywordflow">if</span>($w == 0) { $w = <span class="stringliteral">&quot;&quot;</span>; }
<a name="l00154"></a>00154                 <span class="keywordflow">if</span>($h == 0) { $h = <span class="stringliteral">&quot;&quot;</span>; }
<a name="l00155"></a>00155                 $delim = <span class="stringliteral">&quot;x&quot;</span>;
<a name="l00156"></a>00156                 <span class="keywordflow">return</span> $w.$delim.$h;    
<a name="l00157"></a>00157         }
<a name="l00158"></a>00158         
<a name="l00159"></a><a class="code" href="class_image_resizer.html#a574dbc9475ae19829f1c03592b94d0c0">00159</a>         function <a class="code" href="class_image_resizer.html#a574dbc9475ae19829f1c03592b94d0c0">NewFileName</a>()
<a name="l00160"></a>00160         {
<a name="l00161"></a>00161                 $name = $this-&gt;file_name;
<a name="l00162"></a>00162                 $path = $this-&gt;<a class="code" href="class_image_resizer.html#abd0e72b81c858bdbb74770ad1f2fd470">NewDirCreate</a>();
<a name="l00163"></a>00163                 $full_path = $path.<span class="stringliteral">&quot;/&quot;</span>.$name;
<a name="l00164"></a>00164                 <span class="keywordflow">if</span>(file_exists($full_path))
<a name="l00165"></a>00165                 {
<a name="l00166"></a>00166                         $open = opendir($path);
<a name="l00167"></a>00167                         <span class="keywordflow">while</span>($imgs = readdir($open))
<a name="l00168"></a>00168                         {
<a name="l00169"></a>00169                                 <span class="comment">//if($imgs == $name) { $name = rand().&quot;_&quot;.$name; }</span>
<a name="l00170"></a>00170                         }
<a name="l00171"></a>00171                 }
<a name="l00172"></a>00172                 <span class="keywordflow">return</span> $path.<span class="stringliteral">&quot;/&quot;</span>.$name;
<a name="l00173"></a>00173         }
<a name="l00174"></a>00174         
<a name="l00175"></a><a class="code" href="class_image_resizer.html#abd0e72b81c858bdbb74770ad1f2fd470">00175</a>         function <a class="code" href="class_image_resizer.html#abd0e72b81c858bdbb74770ad1f2fd470">NewDirCreate</a>()
<a name="l00176"></a>00176         {
<a name="l00177"></a>00177                 $newdir = $this-&gt;file_dirname.<span class="stringliteral">&quot;/&quot;</span>.$this-&gt;newdirname;
<a name="l00178"></a>00178                 <span class="keywordflow">if</span>(!is_dir($newdir) &amp;&amp; $this-&gt;isSave == <span class="keyword">true</span>)
<a name="l00179"></a>00179                 {
<a name="l00180"></a>00180                         @mkdir($newdir);
<a name="l00181"></a>00181                 }
<a name="l00182"></a>00182                 <span class="keywordflow">return</span> $newdir;
<a name="l00183"></a>00183         }
<a name="l00184"></a>00184         
<a name="l00185"></a><a class="code" href="class_image_resizer.html#a863e3de9deb278e8f1a3714ca09eb0fb">00185</a>         function <a class="code" href="class_image_resizer.html#a863e3de9deb278e8f1a3714ca09eb0fb">CreateOriginal</a>()
<a name="l00186"></a>00186         {
<a name="l00187"></a>00187                 $exif = $this-&gt;<a class="code" href="class_image_resizer.html#a44a754bed17c81f25d50263ad5841f20">ExifData</a>();
<a name="l00188"></a>00188                 <span class="keywordflow">if</span>(!empty($exif[<span class="stringliteral">&#39;Orientation&#39;</span>])) { $this-&gt;oreintation = $exif[<span class="stringliteral">&#39;Orientation&#39;</span>]; }
<a name="l00189"></a>00189                 
<a name="l00190"></a>00190                 $this-&gt;isCreateDir = <span class="keyword">false</span>;
<a name="l00191"></a>00191                 $this-&gt;<a class="code" href="class_image_resizer.html#ace5da380aeb26e6c3ee3a410d78cad06">Resize</a>($this-&gt;OrigWidth,$this-&gt;OrigHeigth);
<a name="l00192"></a>00192                 $this-&gt;isCreateDir = <span class="keyword">true</span>;
<a name="l00193"></a>00193                 $this-&gt;<a class="code" href="class_image_resizer.html#aebe67aa5a1ffd41a69811e38427c8eba">__construct</a>($this-&gt;inputfile);
<a name="l00194"></a>00194                 
<a name="l00195"></a>00195                 <span class="keywordflow">if</span>($this-&gt;oreintation &gt; 0)
<a name="l00196"></a>00196                 {
<a name="l00197"></a>00197                         $this-&gt;<a class="code" href="class_image_resizer.html#a3948e0f6d174dd5f2969b86b14d83970">AutoRotate</a>();
<a name="l00198"></a>00198                         $this-&gt;<a class="code" href="class_image_resizer.html#aebe67aa5a1ffd41a69811e38427c8eba">__construct</a>($this-&gt;inputfile);
<a name="l00199"></a>00199                 }
<a name="l00200"></a>00200                 <span class="keywordflow">return</span> array($this-&gt;width_orig,$this-&gt;height_orig);
<a name="l00201"></a>00201         }
<a name="l00202"></a>00202         
<a name="l00203"></a><a class="code" href="class_image_resizer.html#adaeda2382d4c1b2a99a01fbac91b720f">00203</a>         function <a class="code" href="class_image_resizer.html#adaeda2382d4c1b2a99a01fbac91b720f">CreateStandart</a>()
<a name="l00204"></a>00204         {
<a name="l00205"></a>00205                 $this-&gt;<a class="code" href="class_image_resizer.html#ace5da380aeb26e6c3ee3a410d78cad06">Resize</a>($this-&gt;StandartWidth,$this-&gt;StandartHeigth,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="stringliteral">&#39;standart&#39;</span>);
<a name="l00206"></a>00206         }
<a name="l00207"></a>00207                 
<a name="l00216"></a><a class="code" href="class_image_resizer.html#ace5da380aeb26e6c3ee3a410d78cad06">00216</a>         function <a class="code" href="class_image_resizer.html#ace5da380aeb26e6c3ee3a410d78cad06">Resize</a>(<a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">$image_w</a>,<a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a>,<a class="code" href="class_image_resizer.html#a8aa9c007d7fe55244da93c464c33d3e1">$image_ratio</a>=<span class="keyword">true</span>, <a class="code" href="class_image_resizer.html#afd83adcc482bcd473ff612fe57a36607">$image_ratio_wb</a>=<span class="keyword">false</span>,$newdir=<span class="keyword">false</span>)
<a name="l00217"></a>00217         {
<a name="l00218"></a>00218                 <span class="keywordflow">if</span>(<a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">$image_w</a> == 0 &amp;&amp; <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a> == 0) { <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_c_error.html">CError</a>(<span class="stringliteral">&#39;WH by zero&#39;</span>);}
<a name="l00219"></a>00219                 
<a name="l00220"></a>00220                 <span class="comment">/* Автоповорот */</span>
<a name="l00221"></a>00221                 <span class="comment">/*</span>
<a name="l00222"></a>00222 <span class="comment">                $this-&gt;AutoRotate();</span>
<a name="l00223"></a>00223 <span class="comment">                $this-&gt;__construct($this-&gt;inputfile);</span>
<a name="l00224"></a>00224 <span class="comment">                */</span>
<a name="l00225"></a>00225                 <span class="comment">/* //Автоповорот */</span>
<a name="l00226"></a>00226                 
<a name="l00227"></a>00227                 
<a name="l00228"></a>00228                 <span class="comment">// Имя папки для файла</span>
<a name="l00229"></a>00229                 <span class="keywordflow">if</span>($this-&gt;isCreateDir == <span class="keyword">true</span>)
<a name="l00230"></a>00230                 {
<a name="l00231"></a>00231                         <span class="keywordflow">if</span>(strlen($newdir) &gt; 0)
<a name="l00232"></a>00232                         {
<a name="l00233"></a>00233                                 $this-&gt;newdirname = $newdir;
<a name="l00234"></a>00234                         }
<a name="l00235"></a>00235                         <span class="keywordflow">else</span>
<a name="l00236"></a>00236                         {
<a name="l00237"></a>00237                                 <span class="keywordflow">if</span>(<a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">$image_w</a> == <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a> &amp;&amp; <a class="code" href="class_image_resizer.html#a8aa9c007d7fe55244da93c464c33d3e1">$image_ratio</a> == <span class="keyword">true</span>)
<a name="l00238"></a>00238                                 {
<a name="l00239"></a>00239                                         <span class="keywordflow">if</span>($this-&gt;width_orig &gt; $this-&gt;height_orig) { $this-&gt;newdirname = $this-&gt;<a class="code" href="class_image_resizer.html#a29c611ea77c8a508fd3323e880f37109">NewDirName</a>(<a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">$image_w</a>,0);  }
<a name="l00240"></a>00240                                         <span class="keywordflow">else</span> { $this-&gt;newdirname = $this-&gt;<a class="code" href="class_image_resizer.html#a29c611ea77c8a508fd3323e880f37109">NewDirName</a>(0,<a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a>); }
<a name="l00241"></a>00241                                 }
<a name="l00242"></a>00242                                 <span class="keywordflow">else</span>
<a name="l00243"></a>00243                                 {
<a name="l00244"></a>00244                                         $this-&gt;newdirname = $this-&gt;<a class="code" href="class_image_resizer.html#a29c611ea77c8a508fd3323e880f37109">NewDirName</a>(<a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">$image_w</a>,<a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a>);
<a name="l00245"></a>00245                                 }
<a name="l00246"></a>00246                         }
<a name="l00247"></a>00247                 }
<a name="l00248"></a>00248                 <span class="comment">// -------------------</span>
<a name="l00249"></a>00249                 
<a name="l00250"></a>00250                 <span class="keywordflow">if</span>(<a class="code" href="class_image_resizer.html#a8aa9c007d7fe55244da93c464c33d3e1">$image_ratio</a> == <span class="keyword">true</span>)
<a name="l00251"></a>00251                 {
<a name="l00252"></a>00252                         <span class="keywordflow">if</span>(<a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">$image_w</a> &gt; $this-&gt;width_orig &amp;&amp; <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a> &gt; $this-&gt;height_orig) { 
<a name="l00253"></a>00253                                 <a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">$image_w</a> = $this-&gt;width_orig;
<a name="l00254"></a>00254                                 <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a> = $this-&gt;height_orig;
<a name="l00255"></a>00255                          }                      
<a name="l00256"></a>00256                         elseif(<a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">$image_w</a> == 0)
<a name="l00257"></a>00257                         {
<a name="l00258"></a>00258                                 $aspect_ratio = (float) $this-&gt;width_orig / $this-&gt;height_orig;
<a name="l00259"></a>00259                                 <a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">$image_w</a> = round(<a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a> * $aspect_ratio);
<a name="l00260"></a>00260                         }
<a name="l00261"></a>00261                         elseif(<a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a> == 0)
<a name="l00262"></a>00262                         {
<a name="l00263"></a>00263                                 $aspect_ratio = (float) $this-&gt;height_orig / $this-&gt;width_orig;
<a name="l00264"></a>00264                                 <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a> = round(<a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">$image_w</a> * $aspect_ratio);
<a name="l00265"></a>00265                         }
<a name="l00266"></a>00266                         elseif(<a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">$image_w</a> == <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a>)
<a name="l00267"></a>00267                         {
<a name="l00268"></a>00268                                 <span class="keywordflow">if</span>($this-&gt;width_orig &gt; $this-&gt;height_orig || $this-&gt;width_orig == $this-&gt;height_orig) 
<a name="l00269"></a>00269                                 {
<a name="l00270"></a>00270                                         $aspect_ratio = (float) $this-&gt;height_orig / $this-&gt;width_orig;
<a name="l00271"></a>00271                                         <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a> = round(<a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">$image_w</a> * $aspect_ratio);
<a name="l00272"></a>00272                                 }
<a name="l00273"></a>00273 
<a name="l00274"></a>00274                                 <span class="keywordflow">if</span>($this-&gt;width_orig &lt; $this-&gt;height_orig) 
<a name="l00275"></a>00275                                 {
<a name="l00276"></a>00276                                         $aspect_ratio = (float) $this-&gt;width_orig / $this-&gt;height_orig;
<a name="l00277"></a>00277                                         <a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">$image_w</a> = round(<a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a> * $aspect_ratio);
<a name="l00278"></a>00278                                 }
<a name="l00279"></a>00279                         }
<a name="l00280"></a>00280                         <span class="keywordflow">else</span>
<a name="l00281"></a>00281                         {
<a name="l00282"></a>00282                                 <span class="keywordflow">if</span>($this-&gt;width_orig &gt; $this-&gt;height_orig || $this-&gt;width_orig == $this-&gt;height_orig) 
<a name="l00283"></a>00283                                 {
<a name="l00284"></a>00284                                         $aspect_ratio = (float) $this-&gt;height_orig / $this-&gt;width_orig;
<a name="l00285"></a>00285                                         <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a> = round(<a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">$image_w</a> * $aspect_ratio);
<a name="l00286"></a>00286                                 }
<a name="l00287"></a>00287 
<a name="l00288"></a>00288                                 <span class="keywordflow">if</span>($this-&gt;width_orig &lt; $this-&gt;height_orig) 
<a name="l00289"></a>00289                                 {
<a name="l00290"></a>00290                                         $aspect_ratio = (float) $this-&gt;width_orig / $this-&gt;height_orig;
<a name="l00291"></a>00291                                         <a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">$image_w</a> = round(<a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a> * $aspect_ratio);
<a name="l00292"></a>00292                                 }
<a name="l00293"></a>00293                         }
<a name="l00294"></a>00294                 }
<a name="l00295"></a>00295                 <span class="keywordflow">else</span>
<a name="l00296"></a>00296                 {
<a name="l00297"></a>00297                         <span class="keywordflow">if</span>(<a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">$image_w</a> == 0) { <a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">$image_w</a> = <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a>; }
<a name="l00298"></a>00298                         <span class="keywordflow">if</span>(<a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a> == 0) { <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a> = <a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">$image_w</a>; }
<a name="l00299"></a>00299                 }
<a name="l00300"></a>00300                 
<a name="l00301"></a>00301                 $this-&gt;<a class="code" href="class_image_resizer.html#a51bc2c64bc7c2bca207cafd629473ed4">Process</a>(<a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">$image_w</a>,<a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a>,<a class="code" href="class_image_resizer.html#a8aa9c007d7fe55244da93c464c33d3e1">$image_ratio</a>,<a class="code" href="class_image_resizer.html#afd83adcc482bcd473ff612fe57a36607">$image_ratio_wb</a>);
<a name="l00302"></a>00302                 
<a name="l00303"></a>00303         }
<a name="l00304"></a>00304         
<a name="l00309"></a><a class="code" href="class_image_resizer.html#a51bc2c64bc7c2bca207cafd629473ed4">00309</a>         function <a class="code" href="class_image_resizer.html#a51bc2c64bc7c2bca207cafd629473ed4">Process</a>(<a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">$image_w</a>,<a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a>,<a class="code" href="class_image_resizer.html#a8aa9c007d7fe55244da93c464c33d3e1">$image_ratio</a>,<a class="code" href="class_image_resizer.html#afd83adcc482bcd473ff612fe57a36607">$image_ratio_wb</a>)
<a name="l00310"></a>00310         {
<a name="l00311"></a>00311                 <span class="keywordflow">if</span>((($this-&gt;width_orig*$this-&gt;height_orig*4)+<a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a>*<a class="code" href="class_image_resizer.html#aa6d54b5342f61aac42552109d0acc129">$image_w</a>*4)&gt;(<a class="code" href="main_2libs_2functions_8php.html#a9103d1a2e8cdef9b3136b8a2a844a8ba">GetMaxMemory</a>()-1024*1024))
<a name="l00312"></a>00312                 {
<a name="l00313"></a>00313                         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_c_error.html">CError</a>(SYSTEM_NO_MEMORY,1,(($this-&gt;width_orig*$this-&gt;height_orig*4)+<a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a>*$image_w*4).<span class="charliteral">&#39;/&#39;</span>.(<a class="code" href="main_2libs_2functions_8php.html#a9103d1a2e8cdef9b3136b8a2a844a8ba">GetMaxMemory</a>()-1024*1024));     
<a name="l00314"></a>00314                 }
<a name="l00315"></a>00315                 <span class="keywordflow">switch</span> ($this-&gt;image_type)
<a name="l00316"></a>00316             {
<a name="l00317"></a>00317                 <span class="keywordflow">case</span> 2: $im = imagecreatefromjpeg($this-&gt;myfile);  <span class="keywordflow">break</span>;
<a name="l00318"></a>00318                 <span class="keywordflow">case</span> 3: $im = imagecreatefrompng($this-&gt;myfile); <span class="keywordflow">break</span>;
<a name="l00319"></a>00319                 <span class="keywordflow">default</span>:  <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_c_error.html">CError</a>(<span class="stringliteral">&#39;PHOTOGALLERY_WRONG_FILE&#39;</span>, E_USER_WARNING);  <span class="keywordflow">break</span>;
<a name="l00320"></a>00320             }
<a name="l00321"></a>00321             
<a name="l00322"></a>00322             <span class="keywordflow">if</span>(<a class="code" href="class_image_resizer.html#a8aa9c007d7fe55244da93c464c33d3e1">$image_ratio</a> == <span class="keyword">true</span>)
<a name="l00323"></a>00323             {
<a name="l00324"></a>00324                 $newImg = imagecreatetruecolor($image_w, <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a>);
<a name="l00325"></a>00325                 imagecopyresampled($newImg, $im, 0, 0, 0, 0, $image_w, <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a>, $this-&gt;width_orig, $this-&gt;height_orig);
<a name="l00326"></a>00326             }
<a name="l00327"></a>00327             <span class="keywordflow">else</span>
<a name="l00328"></a>00328             {
<a name="l00329"></a>00329                 <span class="keywordflow">if</span>(<a class="code" href="class_image_resizer.html#afd83adcc482bcd473ff612fe57a36607">$image_ratio_wb</a> == <span class="keyword">true</span>)
<a name="l00330"></a>00330                 {
<a name="l00331"></a>00331                         $wb_type = 0;
<a name="l00332"></a>00332                         
<a name="l00333"></a>00333                         <span class="keywordflow">if</span>($this-&gt;width_orig &gt; $this-&gt;height_orig || $this-&gt;width_orig == $this-&gt;height_orig)
<a name="l00334"></a>00334                                 {
<a name="l00335"></a>00335                                         $aspect_ratio = (float) $this-&gt;height_orig / $this-&gt;width_orig;
<a name="l00336"></a>00336                                         $image_h_r = round($image_w * $aspect_ratio);
<a name="l00337"></a>00337                                         $image_w_r = $image_w;
<a name="l00338"></a>00338                                         $wb_type = 1;
<a name="l00339"></a>00339                                         <span class="keywordflow">if</span>(<a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a> &lt; $image_h_r)
<a name="l00340"></a>00340                                         {
<a name="l00341"></a>00341                                                 $aspect_ratio = (float) $this-&gt;width_orig / $this-&gt;height_orig;
<a name="l00342"></a>00342                                                 $image_w_r = round(<a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a> * $aspect_ratio);
<a name="l00343"></a>00343                                                 $image_h_r = <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a>;
<a name="l00344"></a>00344                                                 $wb_type = 2;
<a name="l00345"></a>00345                                         }
<a name="l00346"></a>00346                                 }
<a name="l00347"></a>00347                                 elseif($this-&gt;width_orig &lt; $this-&gt;height_orig)
<a name="l00348"></a>00348                                 {
<a name="l00349"></a>00349                                         $aspect_ratio = (float) $this-&gt;width_orig / $this-&gt;height_orig;
<a name="l00350"></a>00350                                         $image_w_r = round(<a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a> * $aspect_ratio);
<a name="l00351"></a>00351                                         $image_h_r = <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a>;
<a name="l00352"></a>00352                                         $wb_type = 2;
<a name="l00353"></a>00353                                         <span class="keywordflow">if</span>($image_w &lt; $image_w_r)
<a name="l00354"></a>00354                                         {
<a name="l00355"></a>00355                                                 $aspect_ratio = (float) $this-&gt;height_orig / $this-&gt;width_orig;
<a name="l00356"></a>00356                                                 $image_h_r = round($image_w * $aspect_ratio);
<a name="l00357"></a>00357                                                 $image_w_r = $image_w;
<a name="l00358"></a>00358                                                 $wb_type = 1;
<a name="l00359"></a>00359                                         }
<a name="l00360"></a>00360                                 }
<a name="l00361"></a>00361                                 $newImg_first = imagecreatetruecolor($image_w_r, $image_h_r);
<a name="l00362"></a>00362                                 imagecopyresampled($newImg_first, $im, 0, 0, 0, 0, $image_w_r, $image_h_r, $this-&gt;width_orig, $this-&gt;height_orig);      
<a name="l00363"></a>00363                         
<a name="l00364"></a>00364                         
<a name="l00365"></a>00365                         $newImg = imagecreatetruecolor($image_w, <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a>);
<a name="l00366"></a>00366                         <span class="keywordflow">if</span>($this-&gt;border_color != <span class="stringliteral">&quot;&quot;</span>) 
<a name="l00367"></a>00367                         { 
<a name="l00368"></a>00368                                 $colors = explode(<span class="stringliteral">&quot; &quot;</span>,$this-&gt;border_color); 
<a name="l00369"></a>00369                                 $r = $colors[0];
<a name="l00370"></a>00370                                 $g = $colors[1];
<a name="l00371"></a>00371                                 $b = $colors[2];
<a name="l00372"></a>00372                         } <span class="keywordflow">else</span> { $r = 255; $g = 255; $b = 255; }
<a name="l00373"></a>00373                         
<a name="l00374"></a>00374                         <a class="code" href="kcaptcha__config_8php.html#ab99599d1702f329ce472bcbf96846531">$background_color</a> = imagecolorallocate($newImg, $r, $g, $b);
<a name="l00375"></a>00375                                 imagefill($newImg, 0, 0, <a class="code" href="kcaptcha__config_8php.html#ab99599d1702f329ce472bcbf96846531">$background_color</a>);
<a name="l00376"></a>00376                                 
<a name="l00377"></a>00377                                 <span class="keywordflow">if</span>($wb_type == 1)
<a name="l00378"></a>00378                                 {
<a name="l00379"></a>00379                                         $one = round((<a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a> - $image_h_r)/2);
<a name="l00380"></a>00380                                          
<a name="l00381"></a>00381                                         imagecopyresampled($newImg, $newImg_first, 0, round((<a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a> - $image_h_r)/2), 0, 0, $image_w_r, $image_h_r, $image_w_r, $image_h_r);          
<a name="l00382"></a>00382                                 }
<a name="l00383"></a>00383                                 
<a name="l00384"></a>00384                                 <span class="keywordflow">if</span>($wb_type == 2)
<a name="l00385"></a>00385                                 {
<a name="l00386"></a>00386                                         imagecopyresampled($newImg, $newImg_first,  round(($image_w - $image_w_r)/2), 0, 0, 0, $image_w_r, $image_h_r, $image_w_r, $image_h_r);         
<a name="l00387"></a>00387                                 }
<a name="l00388"></a>00388                                 
<a name="l00389"></a>00389                 }
<a name="l00390"></a>00390                 
<a name="l00391"></a>00391                 <span class="keywordflow">if</span>(<a class="code" href="class_image_resizer.html#afd83adcc482bcd473ff612fe57a36607">$image_ratio_wb</a> == <span class="keyword">false</span>)
<a name="l00392"></a>00392                 {
<a name="l00393"></a>00393                         <span class="comment">//Только в квадратный вид</span>
<a name="l00394"></a>00394                         <span class="keywordflow">if</span>($this-&gt;width_orig &gt; $image_w &amp;&amp; $this-&gt;height_orig &gt; <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a>) 
<a name="l00395"></a>00395                         {
<a name="l00396"></a>00396                                 $WH = max(<a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a>,$image_w);
<a name="l00397"></a>00397                                 <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a> = $WH;
<a name="l00398"></a>00398                                 $image_w = $WH;
<a name="l00399"></a>00399                                 
<a name="l00400"></a>00400                                 $newImg = imagecreatetruecolor($image_w, <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a>);
<a name="l00401"></a>00401                                 
<a name="l00402"></a>00402                                 
<a name="l00403"></a>00403                                         <span class="keywordflow">if</span>($this-&gt;width_orig &gt; $this-&gt;height_orig || $this-&gt;width_orig == $this-&gt;height_orig) 
<a name="l00404"></a>00404                                          {
<a name="l00405"></a>00405                                                 imagecopyresampled($newImg, $im, 0, 0,
<a name="l00406"></a>00406                                                 round((max($this-&gt;width_orig,$this-&gt;height_orig)-min($this-&gt;width_orig,$this-&gt;height_orig))/2),
<a name="l00407"></a>00407                                                 0, $image_w, <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a>,
<a name="l00408"></a>00408                                                 min($this-&gt;width_orig,$this-&gt;height_orig), min($this-&gt;width_orig,$this-&gt;height_orig));
<a name="l00409"></a>00409                                          }
<a name="l00410"></a>00410                                          
<a name="l00411"></a>00411                                          <span class="keywordflow">if</span>($this-&gt;width_orig &lt; $this-&gt;height_orig)
<a name="l00412"></a>00412                                          {
<a name="l00413"></a>00413                                                 <span class="keywordflow">switch</span>($this-&gt;square_align)
<a name="l00414"></a>00414                                                 {
<a name="l00415"></a>00415                                                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;top&#39;</span>: $start = 0;
<a name="l00416"></a>00416                                                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;center&#39;</span>: $start = round((max($this-&gt;width_orig,$this-&gt;height_orig)-min($this-&gt;width_orig,$this-&gt;height_orig))/2);
<a name="l00417"></a>00417                                                 }
<a name="l00418"></a>00418                                                 imagecopyresampled($newImg, $im, 0, 0, 0, $start, $image_w, <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a>,
<a name="l00419"></a>00419                                                       min($this-&gt;width_orig,$this-&gt;height_orig), min($this-&gt;width_orig,$this-&gt;height_orig)); 
<a name="l00420"></a>00420                                          }       
<a name="l00421"></a>00421                                   
<a name="l00422"></a>00422                         }
<a name="l00423"></a>00423                         <span class="keywordflow">else</span>
<a name="l00424"></a>00424                         {
<a name="l00425"></a>00425                                 <span class="comment">// Если новые размеры больше старых, то изображение остается неизменным</span>
<a name="l00426"></a>00426                                 $image_w = $this-&gt;width_orig;
<a name="l00427"></a>00427                                 <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a> = $this-&gt;height_orig;
<a name="l00428"></a>00428                                 $newImg = imagecreatetruecolor($image_w, <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a>);
<a name="l00429"></a>00429                                 imagecopyresampled($newImg, $im, 0, 0, 0, 0, $image_w, <a class="code" href="class_image_resizer.html#a9ee2a5b4afe63a0200528332f2ec001f">$image_h</a>, $this-&gt;width_orig, $this-&gt;height_orig);
<a name="l00430"></a>00430                         }
<a name="l00431"></a>00431                 }
<a name="l00432"></a>00432                 
<a name="l00433"></a>00433             }
<a name="l00434"></a>00434             
<a name="l00435"></a>00435            
<a name="l00436"></a>00436             <span class="keywordflow">if</span>($this-&gt;isSave == <span class="keyword">true</span>)
<a name="l00437"></a>00437             {
<a name="l00438"></a>00438                     <span class="comment">// Генерация нового имени файла пример: путь/ширинаХвысота_оригимяфайла</span>
<a name="l00439"></a>00439                     <a class="code" href="class_image_resizer.html#a08ca978795d13de8f801d343ea6fcaac">$newfilename</a> = $this-&gt;<a class="code" href="class_image_resizer.html#a574dbc9475ae19829f1c03592b94d0c0">NewFileName</a>();
<a name="l00440"></a>00440                     <span class="keywordflow">switch</span> ($this-&gt;image_type)
<a name="l00441"></a>00441                     {
<a name="l00442"></a>00442                         <span class="comment">//case 1: imagegif($newImg,$newfilename); break;</span>
<a name="l00443"></a>00443                         <span class="keywordflow">case</span> 2: imagejpeg($newImg,<a class="code" href="class_image_resizer.html#a08ca978795d13de8f801d343ea6fcaac">$newfilename</a>,$this-&gt;quality);  <span class="keywordflow">break</span>;
<a name="l00444"></a>00444                         <span class="keywordflow">case</span> 3: imagepng($newImg,<a class="code" href="class_image_resizer.html#a08ca978795d13de8f801d343ea6fcaac">$newfilename</a>); <span class="keywordflow">break</span>;
<a name="l00445"></a>00445                         <span class="keywordflow">default</span>:  <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_c_error.html">CError</a>(<span class="stringliteral">&#39;Failed resize image!&#39;</span>, E_USER_WARNING);  <span class="keywordflow">break</span>;
<a name="l00446"></a>00446                     }
<a name="l00447"></a>00447             }
<a name="l00448"></a>00448             $this-&gt;newImage=$newImg;
<a name="l00449"></a>00449                 imagedestroy($im);
<a name="l00450"></a>00450         }
<a name="l00451"></a>00451 
<a name="l00455"></a><a class="code" href="class_image_resizer.html#a36374dc328818e906dd2324babd06de2">00455</a>         function <a class="code" href="class_image_resizer.html#a36374dc328818e906dd2324babd06de2">Save</a>($path)
<a name="l00456"></a>00456         {
<a name="l00457"></a>00457                 <span class="keywordflow">if</span>($this-&gt;newImage)
<a name="l00458"></a>00458                 {
<a name="l00459"></a>00459                         $res=@imagejpeg($this-&gt;newImage,$path,$this-&gt;quality);
<a name="l00460"></a>00460                         <span class="keywordflow">if</span>(!imagedestroy($this-&gt;newImage)) <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_c_error.html">CError</a>(<span class="stringliteral">&#39;SYSTEM_STRANGE_ERROR&#39;</span>);
<a name="l00461"></a>00461                         $this-&gt;newImage=0;
<a name="l00462"></a>00462                         <span class="keywordflow">return</span> $res;
<a name="l00463"></a>00463                 }       
<a name="l00464"></a>00464         }       
<a name="l00465"></a>00465         
<a name="l00469"></a><a class="code" href="class_image_resizer.html#ac928293d5f51a2e8f04927b0d31e51c5">00469</a>         function <a class="code" href="class_image_resizer.html#ac928293d5f51a2e8f04927b0d31e51c5">Crop</a>($x1,$y1,$x2,$y2)
<a name="l00470"></a>00470         {
<a name="l00471"></a>00471                 <span class="keywordflow">if</span>($x2&lt;$x1){$tmp=$x2;$x2=$x1;$x1=$x2;}
<a name="l00472"></a>00472                 <span class="keywordflow">if</span>($y2&lt;$y1){$tmp=$y2;$y2=$y1;$y1=$y2;}
<a name="l00473"></a>00473                 <span class="keywordflow">if</span>($x1&lt;0) $x1=0;
<a name="l00474"></a>00474                 <span class="keywordflow">if</span>($y1&lt;0) $y1=0;
<a name="l00475"></a>00475                 <span class="keywordflow">if</span>($x2&gt;$this-&gt;width_orig) $x2=$this-&gt;width_orig;
<a name="l00476"></a>00476                 <span class="keywordflow">if</span>($y2&gt;$this-&gt;height_orig)$y2=$this-&gt;height_orig;
<a name="l00477"></a>00477                 $newWidth=$x2-$x1;
<a name="l00478"></a>00478                 $newHeight=$y2-$y1;
<a name="l00479"></a>00479                 <span class="keywordflow">if</span>($this-&gt;width_orig==$newWidth &amp;&amp; $this-&gt;height_orig==$newHeight) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00480"></a>00480                 <span class="keywordflow">if</span>($newWidth==0||$newHeight==0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00481"></a>00481                 <span class="keywordflow">switch</span> ($this-&gt;image_type)
<a name="l00482"></a>00482             {
<a name="l00483"></a>00483                 <span class="keywordflow">case</span> 2: $im = imagecreatefromjpeg(ROOT_DIR.$this-&gt;inputfile);  <span class="keywordflow">break</span>;
<a name="l00484"></a>00484                 <span class="keywordflow">case</span> 3: $im = imagecreatefrompng(ROOT_DIR.$this-&gt;inputfile); <span class="keywordflow">break</span>;
<a name="l00485"></a>00485                 <span class="keywordflow">default</span>:  <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_c_error.html">CError</a>(<span class="stringliteral">&#39;Unsupported filetype!&#39;</span>, E_USER_WARNING);  <span class="keywordflow">break</span>;
<a name="l00486"></a>00486             }
<a name="l00487"></a>00487                 $newImg = imagecreatetruecolor($newWidth, $newHeight);
<a name="l00488"></a>00488             imagecopyresampled($newImg, $im, 0, 0, $x1, $y1, $newWidth,$newHeight,$newWidth,$newHeight);
<a name="l00489"></a>00489             <span class="keywordflow">switch</span> ($this-&gt;image_type)
<a name="l00490"></a>00490             {
<a name="l00491"></a>00491                 <span class="comment">//case 1: imagegif($newImg,$newfilename); break;</span>
<a name="l00492"></a>00492                 <span class="keywordflow">case</span> 2: <span class="keywordflow">return</span> imagejpeg($newImg,ROOT_DIR.$this-&gt;inputfile,$this-&gt;quality);  <span class="keywordflow">break</span>;
<a name="l00493"></a>00493                 <span class="keywordflow">case</span> 3: <span class="keywordflow">return</span> imagepng($newImg,ROOT_DIR.$this-&gt;inputfile); <span class="keywordflow">break</span>;
<a name="l00494"></a>00494                 <span class="keywordflow">default</span>:  <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_c_error.html">CError</a>(<span class="stringliteral">&#39;Failed crop image!&#39;</span>, E_USER_WARNING);  <span class="keywordflow">break</span>;
<a name="l00495"></a>00495             }
<a name="l00496"></a>00496         }
<a name="l00497"></a>00497         
<a name="l00498"></a>00498         <span class="comment">/* ---================--- */</span>
<a name="l00499"></a><a class="code" href="class_image_resizer.html#a44a754bed17c81f25d50263ad5841f20">00499</a>         function <a class="code" href="class_image_resizer.html#a44a754bed17c81f25d50263ad5841f20">ExifData</a>()
<a name="l00500"></a>00500         {
<a name="l00501"></a>00501                 $exif_data = @exif_read_data($this-&gt;myfile);
<a name="l00502"></a>00502                 <span class="keywordflow">return</span> $exif_data;
<a name="l00503"></a>00503         }
<a name="l00504"></a>00504         
<a name="l00505"></a><a class="code" href="class_image_resizer.html#a920bb1eb1c6fbb82cf6dce4b85cf3179">00505</a>         function <a class="code" href="class_image_resizer.html#a920bb1eb1c6fbb82cf6dce4b85cf3179">ImageRotateSec</a>($src_img, $angle, $bicubic=<span class="keyword">false</span>) 
<a name="l00506"></a>00506         {
<a name="l00507"></a>00507  
<a name="l00508"></a>00508            <span class="comment">// convert degrees to radians</span>
<a name="l00509"></a>00509            $angle = $angle;
<a name="l00510"></a>00510            $angle = deg2rad($angle);
<a name="l00511"></a>00511          
<a name="l00512"></a>00512            $src_x = imagesx($src_img);
<a name="l00513"></a>00513            $src_y = imagesy($src_img);
<a name="l00514"></a>00514          
<a name="l00515"></a>00515            $center_x = floor($src_x/2);
<a name="l00516"></a>00516            $center_y = floor($src_y/2);
<a name="l00517"></a>00517         
<a name="l00518"></a>00518            $cosangle = cos($angle);
<a name="l00519"></a>00519            $sinangle = sin($angle);
<a name="l00520"></a>00520         
<a name="l00521"></a>00521            $corners=array(array(0,0), array($src_x,0), array($src_x,$src_y), array(0,$src_y));
<a name="l00522"></a>00522         
<a name="l00523"></a>00523            <span class="keywordflow">foreach</span>($corners as $key=&gt;<a class="code" href="linkcat_2show_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>) {
<a name="l00524"></a>00524              <a class="code" href="linkcat_2show_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>[0]-=$center_x;        <span class="comment">//Translate coords to center for rotation</span>
<a name="l00525"></a>00525              <a class="code" href="linkcat_2show_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>[1]-=$center_y;
<a name="l00526"></a>00526              $temp=array();
<a name="l00527"></a>00527              $temp[0]=<a class="code" href="linkcat_2show_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>[0]*$cosangle+<a class="code" href="linkcat_2show_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>[1]*$sinangle;
<a name="l00528"></a>00528              $temp[1]=<a class="code" href="linkcat_2show_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>[1]*$cosangle-<a class="code" href="linkcat_2show_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>[0]*$sinangle;
<a name="l00529"></a>00529              $corners[$key]=$temp;   
<a name="l00530"></a>00530            }
<a name="l00531"></a>00531           
<a name="l00532"></a>00532            $min_x=1000000000000000;
<a name="l00533"></a>00533            $max_x=-1000000000000000;
<a name="l00534"></a>00534            $min_y=1000000000000000;
<a name="l00535"></a>00535            $max_y=-1000000000000000;
<a name="l00536"></a>00536           
<a name="l00537"></a>00537            <span class="keywordflow">foreach</span>($corners as $key =&gt; <a class="code" href="linkcat_2show_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>) {
<a name="l00538"></a>00538              <span class="keywordflow">if</span>(<a class="code" href="linkcat_2show_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>[0]&lt;$min_x)
<a name="l00539"></a>00539                $min_x=<a class="code" href="linkcat_2show_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>[0];
<a name="l00540"></a>00540              <span class="keywordflow">if</span>(<a class="code" href="linkcat_2show_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>[0]&gt;$max_x)
<a name="l00541"></a>00541                $max_x=<a class="code" href="linkcat_2show_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>[0];
<a name="l00542"></a>00542           
<a name="l00543"></a>00543              <span class="keywordflow">if</span>(<a class="code" href="linkcat_2show_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>[1]&lt;$min_y)
<a name="l00544"></a>00544                $min_y=<a class="code" href="linkcat_2show_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>[1];
<a name="l00545"></a>00545              <span class="keywordflow">if</span>(<a class="code" href="linkcat_2show_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>[1]&gt;$max_y)
<a name="l00546"></a>00546                $max_y=<a class="code" href="linkcat_2show_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>[1];
<a name="l00547"></a>00547            }
<a name="l00548"></a>00548         
<a name="l00549"></a>00549            $rotate_width=round($max_x-$min_x);
<a name="l00550"></a>00550            $rotate_height=round($max_y-$min_y);
<a name="l00551"></a>00551         
<a name="l00552"></a>00552            $rotate=imagecreatetruecolor($rotate_width,$rotate_height);
<a name="l00553"></a>00553            imagealphablending($rotate, <span class="keyword">false</span>);
<a name="l00554"></a>00554            imagesavealpha($rotate, <span class="keyword">true</span>);
<a name="l00555"></a>00555         
<a name="l00556"></a>00556            <span class="comment">//Reset center to center of our image</span>
<a name="l00557"></a>00557            $newcenter_x = ($rotate_width)/2;
<a name="l00558"></a>00558            $newcenter_y = ($rotate_height)/2;
<a name="l00559"></a>00559         
<a name="l00560"></a>00560            <span class="keywordflow">for</span> ($y = 0; $y &lt; ($rotate_height); $y++) {
<a name="l00561"></a>00561              <span class="keywordflow">for</span> ($x = 0; $x &lt; ($rotate_width); $x++) {
<a name="l00562"></a>00562                <span class="comment">// rotate...</span>
<a name="l00563"></a>00563                $old_x = round((($newcenter_x-$x) * $cosangle + ($newcenter_y-$y) * $sinangle))
<a name="l00564"></a>00564                  + $center_x;
<a name="l00565"></a>00565                $old_y = round((($newcenter_y-$y) * $cosangle - ($newcenter_x-$x) * $sinangle))
<a name="l00566"></a>00566                  + $center_y;
<a name="l00567"></a>00567              
<a name="l00568"></a>00568                <span class="keywordflow">if</span> ( $old_x &gt;= 0 &amp;&amp; $old_x &lt; $src_x
<a name="l00569"></a>00569                      &amp;&amp; $old_y &gt;= 0 &amp;&amp; $old_y &lt; $src_y ) {
<a name="l00570"></a>00570         
<a name="l00571"></a>00571                    $color = imagecolorat($src_img, $old_x, $old_y);
<a name="l00572"></a>00572                } <span class="keywordflow">else</span> {
<a name="l00573"></a>00573                  <span class="comment">// this line sets the background colour</span>
<a name="l00574"></a>00574                  $color = imagecolorallocatealpha($src_img, 255, 255, 255, 127);
<a name="l00575"></a>00575                }
<a name="l00576"></a>00576                imagesetpixel($rotate, $x, $y, $color);
<a name="l00577"></a>00577              }
<a name="l00578"></a>00578            }
<a name="l00579"></a>00579           
<a name="l00580"></a>00580           <span class="keywordflow">return</span>($rotate);
<a name="l00581"></a>00581         }
<a name="l00582"></a>00582         
<a name="l00583"></a>00583         
<a name="l00584"></a><a class="code" href="class_image_resizer.html#a7ca7e53e69392964536f2b9f9cfe0476">00584</a>         function <a class="code" href="class_image_resizer.html#a7ca7e53e69392964536f2b9f9cfe0476">Rotate</a>($src, $degrees)
<a name="l00585"></a>00585         {
<a name="l00586"></a>00586                 $dest = imagecreatefromjpeg($src);
<a name="l00587"></a>00587                 <span class="comment">//$dest = imagerotate($dest, $degrees, 0); - не работает в Ubuntu</span>
<a name="l00588"></a>00588                 $dest = $this-&gt;<a class="code" href="class_image_resizer.html#a920bb1eb1c6fbb82cf6dce4b85cf3179">ImageRotateSec</a>($dest, $degrees);
<a name="l00589"></a>00589                 <span class="keywordflow">return</span> $dest;
<a name="l00590"></a>00590         }
<a name="l00591"></a>00591         
<a name="l00592"></a><a class="code" href="class_image_resizer.html#af58ec6c8c2f01618c8683062a412482f">00592</a>         function <a class="code" href="class_image_resizer.html#af58ec6c8c2f01618c8683062a412482f">Mirror</a>($src, <a class="code" href="main_2fields_2file_2config_8php.html#abe0b3d169d70eace6fd953dfc091f088">$type</a>)
<a name="l00593"></a>00593         {
<a name="l00594"></a>00594                 $imgsrc = imagecreatefromjpeg($src);
<a name="l00595"></a>00595                 <a class="code" href="kcaptcha__config_8php.html#a5795120b4b324bc4ca83f1e6fdce7d57">$width</a> = imagesx($imgsrc);
<a name="l00596"></a>00596                 <a class="code" href="kcaptcha__config_8php.html#a2c265bba1724371bb03e6901297c30b2">$height</a> = imagesy($imgsrc);
<a name="l00597"></a>00597                 $imgdest = imagecreatetruecolor(<a class="code" href="kcaptcha__config_8php.html#a5795120b4b324bc4ca83f1e6fdce7d57">$width</a>, <a class="code" href="kcaptcha__config_8php.html#a2c265bba1724371bb03e6901297c30b2">$height</a>);
<a name="l00598"></a>00598                 <span class="keywordflow">for</span> ($x=0 ; $x&lt;<a class="code" href="kcaptcha__config_8php.html#a5795120b4b324bc4ca83f1e6fdce7d57">$width</a> ; $x++)
<a name="l00599"></a>00599                 {
<a name="l00600"></a>00600                         <span class="keywordflow">for</span> ($y=0 ; $y&lt;<a class="code" href="kcaptcha__config_8php.html#a2c265bba1724371bb03e6901297c30b2">$height</a> ; $y++)
<a name="l00601"></a>00601                         {
<a name="l00602"></a>00602                                 <span class="keywordflow">if</span> (<a class="code" href="main_2fields_2file_2config_8php.html#abe0b3d169d70eace6fd953dfc091f088">$type</a> == 1) imagecopy($imgdest, $imgsrc, $width-$x-1, $y, $x, $y, 1, 1);
<a name="l00603"></a>00603                                 <span class="keywordflow">if</span> (<a class="code" href="main_2fields_2file_2config_8php.html#abe0b3d169d70eace6fd953dfc091f088">$type</a> == 2) imagecopy($imgdest, $imgsrc, $x, $height-$y-1, $x, $y, 1, 1);
<a name="l00604"></a>00604                                 <span class="keywordflow">if</span> (<a class="code" href="main_2fields_2file_2config_8php.html#abe0b3d169d70eace6fd953dfc091f088">$type</a> == 3) imagecopy($imgdest, $imgsrc, $width-$x-1, $height-$y-1, $x, $y, 1, 1);
<a name="l00605"></a>00605                         }
<a name="l00606"></a>00606                 }
<a name="l00607"></a>00607                 
<a name="l00608"></a>00608                 <span class="keywordflow">return</span> $imgdest;
<a name="l00609"></a>00609         }
<a name="l00610"></a>00610         
<a name="l00611"></a><a class="code" href="class_image_resizer.html#a3948e0f6d174dd5f2969b86b14d83970">00611</a>         function <a class="code" href="class_image_resizer.html#a3948e0f6d174dd5f2969b86b14d83970">AutoRotate</a>($orient=<span class="keyword">true</span>)
<a name="l00612"></a>00612         {
<a name="l00613"></a>00613                 $source = $this-&gt;myfile;
<a name="l00614"></a>00614                 $exif = $this-&gt;<a class="code" href="class_image_resizer.html#a44a754bed17c81f25d50263ad5841f20">ExifData</a>();
<a name="l00615"></a>00615                 <span class="keywordflow">if</span>(!empty($exif[<span class="stringliteral">&#39;Orientation&#39;</span>])) { $orientation = $exif[<span class="stringliteral">&#39;Orientation&#39;</span>]; }
<a name="l00616"></a>00616                 <span class="keywordflow">else</span> { $orientation = $this-&gt;oreintation; }
<a name="l00617"></a>00617                 
<a name="l00618"></a>00618                 <span class="comment">// Автоматический поворот изображений (для камер с датчиком ориентации)</span>
<a name="l00619"></a>00619                 
<a name="l00620"></a>00620                 <span class="keywordflow">if</span>($orientation &gt; 0 &amp;&amp; $orient)
<a name="l00621"></a>00621                 {
<a name="l00622"></a>00622                         <span class="keywordflow">switch</span>($orientation)
<a name="l00623"></a>00623                     {
<a name="l00624"></a>00624                         <span class="keywordflow">case</span> 1: <span class="comment">// nothing</span>
<a name="l00625"></a>00625                         <span class="keywordflow">break</span>;
<a name="l00626"></a>00626                 
<a name="l00627"></a>00627                         <span class="keywordflow">case</span> 2: <span class="comment">// horizontal flip</span>
<a name="l00628"></a>00628                             $dest = $this-&gt;<a class="code" href="class_image_resizer.html#af58ec6c8c2f01618c8683062a412482f">Mirror</a>($source, 1);
<a name="l00629"></a>00629                         <span class="keywordflow">break</span>;
<a name="l00630"></a>00630                                                
<a name="l00631"></a>00631                         <span class="keywordflow">case</span> 3: <span class="comment">// 180 rotate left</span>
<a name="l00632"></a>00632                             $dest = $this-&gt;<a class="code" href="class_image_resizer.html#a7ca7e53e69392964536f2b9f9cfe0476">Rotate</a>($source,180);
<a name="l00633"></a>00633                         <span class="keywordflow">break</span>;
<a name="l00634"></a>00634                                    
<a name="l00635"></a>00635                         <span class="keywordflow">case</span> 4: <span class="comment">// vertical flip</span>
<a name="l00636"></a>00636                             $dest = $this-&gt;<a class="code" href="class_image_resizer.html#af58ec6c8c2f01618c8683062a412482f">Mirror</a>($source, 2);
<a name="l00637"></a>00637                         <span class="keywordflow">break</span>;
<a name="l00638"></a>00638                                
<a name="l00639"></a>00639                         <span class="keywordflow">case</span> 5: <span class="comment">// vertical flip + 90 rotate right</span>
<a name="l00640"></a>00640                             $dest_first = $this-&gt;<a class="code" href="class_image_resizer.html#af58ec6c8c2f01618c8683062a412482f">Mirror</a>($source, 2);
<a name="l00641"></a>00641                             $dest = $this-&gt;<a class="code" href="class_image_resizer.html#a7ca7e53e69392964536f2b9f9cfe0476">Rotate</a>($dest_first,-90);
<a name="l00642"></a>00642                         <span class="keywordflow">break</span>;
<a name="l00643"></a>00643                                
<a name="l00644"></a>00644                         <span class="keywordflow">case</span> 6: <span class="comment">// 90 rotate right</span>
<a name="l00645"></a>00645                             $dest = $this-&gt;<a class="code" href="class_image_resizer.html#a7ca7e53e69392964536f2b9f9cfe0476">Rotate</a>($source,-90);
<a name="l00646"></a>00646                         <span class="keywordflow">break</span>;
<a name="l00647"></a>00647                                
<a name="l00648"></a>00648                         <span class="keywordflow">case</span> 7: <span class="comment">// horizontal flip + 90 rotate right</span>
<a name="l00649"></a>00649                             $dest_first = $this-&gt;<a class="code" href="class_image_resizer.html#af58ec6c8c2f01618c8683062a412482f">Mirror</a>($source, 1);   
<a name="l00650"></a>00650                             $dest = $this-&gt;<a class="code" href="class_image_resizer.html#a7ca7e53e69392964536f2b9f9cfe0476">Rotate</a>($source,-90);
<a name="l00651"></a>00651                         <span class="keywordflow">break</span>;
<a name="l00652"></a>00652                                
<a name="l00653"></a>00653                         <span class="keywordflow">case</span> 8:    <span class="comment">// 90 rotate left</span>
<a name="l00654"></a>00654                             $dest = $this-&gt;<a class="code" href="class_image_resizer.html#a7ca7e53e69392964536f2b9f9cfe0476">Rotate</a>($source,90);
<a name="l00655"></a>00655                         <span class="keywordflow">break</span>;
<a name="l00656"></a>00656                     }
<a name="l00657"></a>00657                     <span class="keywordflow">if</span>($dest)
<a name="l00658"></a>00658                     {
<a name="l00659"></a>00659                             imagejpeg($dest,$this-&gt;myfile,$this-&gt;quality);
<a name="l00660"></a>00660                             imagedestroy($dest);
<a name="l00661"></a>00661                     }
<a name="l00662"></a>00662                 }
<a name="l00663"></a>00663         }
<a name="l00664"></a>00664 
<a name="l00665"></a>00665 } 
<a name="l00666"></a>00666 ?&gt;
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Документация по KS-CMS. Последние изменения: Wed Mar 2 2011 17:46:19. Создано системой&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
